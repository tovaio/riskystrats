(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{16:function(e,t,o){e.exports={mapEdgeVisible:"MapEdge_mapEdgeVisible__2Ry56",mapEdgeInvisible:"MapEdge_mapEdgeInvisible__1JHUX"}},17:function(e,t,o){e.exports={mapArmyText:"MapArmy_mapArmyText__WrFei"}},35:function(e,t,o){e.exports={selectedCircle:"SelectedCircle_selectedCircle__3K0j8"}},36:function(e,t,o){e.exports=o(75)},41:function(e,t,o){},6:function(e,t,o){e.exports={mapNodeCircle:"MapNode_mapNodeCircle__1y6lu",mapNodeText:"MapNode_mapNodeText__1YOMw"}},70:function(e,t){},73:function(e,t,o){},74:function(e,t,o){},75:function(e,t,o){"use strict";o.r(t);var n,a=o(0),r=o.n(a),d=o(33),c=o.n(d),i=(o(41),o(2)),m=o(34),s=o.n(m);!function(e){e[e.SetSocket=0]="SetSocket",e[e.SetRoom=1]="SetRoom",e[e.SetPlayer=2]="SetPlayer",e[e.SetRoomList=3]="SetRoomList"}(n||(n={}));var l,u={socket:void 0,room:void 0,player:void 0,roomList:void 0},v=function(e,t){switch(t.type){case n.SetSocket:return{socket:t.socket,room:e.room,player:e.player,roomList:e.roomList};case n.SetRoom:return{socket:e.socket,room:t.room,player:e.player,roomList:e.roomList};case n.SetPlayer:return{socket:e.socket,room:e.room,player:t.player,roomList:e.roomList};case n.SetRoomList:return{socket:e.socket,room:e.room,player:e.player,roomList:t.roomList};default:throw new Error("Action type not found for clientStateReducer!")}},y=function(e){var t=Object(a.useCallback)((function(){void 0!==e.socket&&e.socket.emit("createRoom",2,!1)}),[e.socket]),o=Object(a.useCallback)((function(t){void 0!==e.socket&&e.socket.emit("joinRoom",t.id)}),[e.socket]);if(void 0!==e.roomList){var n=e.roomList.map((function(e){return r.a.createElement("p",{onMouseDown:function(){o(e)}},e.name,": ",e.nPlayers," players / ",e.maxPlayers," max players / ",e.nSpectators," spectators")}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{onMouseDown:function(){t()}},"Create Room!"),n)}return r.a.createElement("p",null,"Waiting to retrieve the room list from the server...")};!function(e){e[e.SetNodeHoveredID=0]="SetNodeHoveredID",e[e.SetNodeSelectedID=1]="SetNodeSelectedID",e[e.SetMouseDown=2]="SetMouseDown"}(l||(l={}));var p,f,D={nodeHoveredID:void 0,nodeSelectedID:void 0,mouseDown:!1},S=function(e,t){switch(t.type){case l.SetNodeHoveredID:return{nodeHoveredID:t.nodeHoveredID,nodeSelectedID:e.nodeSelectedID,mouseDown:e.mouseDown};case l.SetNodeSelectedID:return{nodeHoveredID:e.nodeHoveredID,nodeSelectedID:t.nodeSelectedID,mouseDown:e.mouseDown};case l.SetMouseDown:return{nodeHoveredID:e.nodeHoveredID,nodeSelectedID:e.nodeSelectedID,mouseDown:t.mouseDown};default:throw new Error("Action type not found for roomStateReducer!")}},h=o(3),k=o(1);!function(e){e[e.Neutral=0]="Neutral",e[e.Red=1]="Red",e[e.Blue=2]="Blue",e[e.Green=3]="Green",e[e.Yellow=4]="Yellow",e[e.Orange=5]="Orange",e[e.Purple=6]="Purple"}(p||(p={}));var I,w=(f={},Object(k.a)(f,p.Neutral,"#444444"),Object(k.a)(f,p.Red,"#DD0000"),Object(k.a)(f,p.Blue,"#0000DD"),Object(k.a)(f,p.Green,"#00DD00"),Object(k.a)(f,p.Yellow,"#DDDD00"),Object(k.a)(f,p.Orange,"#DD7700"),Object(k.a)(f,p.Purple,"#7700DD"),f);!function(e){e[e.Normal=0]="Normal",e[e.Factory=1]="Factory",e[e.PowerPlant=2]="PowerPlant",e[e.Fort=3]="Fort",e[e.Artillery=4]="Artillery"}(I||(I={}));var g,E=o(6),b=o.n(E),M=function(e,t,o,n){return r.a.createElement("circle",{className:b.a.mapNodeCircle,cx:e,cy:t,r:o,style:n})},x=function(e,t){for(var o=2/(1+1/Math.sin(Math.PI/e)),n=2*Math.PI/e,a=[],d="",c=0;c<e;c++){var i=n*c,m=t.cx+Math.sin(i)*o/Math.sin(n/2),s=t.cy-Math.cos(i)*o/Math.sin(n/2);a.push(M(m,s,o,{fill:t.fill,stroke:t.stroke,strokeWidth:5/9})),d+="".concat(0===c?"M":"L"," ").concat(m,",").concat(s," ")}return d+="Z",a.push(r.a.createElement("path",{className:b.a.mapNodeCircle,d:d,fill:t.fill,stroke:t.fill,strokeWidth:5/9/2})),r.a.createElement(r.a.Fragment,null,a)},N=(g={},Object(k.a)(g,I.Normal,(function(e){return M(e.cx,e.cy,2,{fill:e.fill,stroke:e.stroke,strokeWidth:5/9})})),Object(k.a)(g,I.Factory,(function(e){return x(2,e)})),Object(k.a)(g,I.PowerPlant,(function(e){return x(3,e)})),Object(k.a)(g,I.Fort,(function(e){return x(4,e)})),Object(k.a)(g,I.Artillery,(function(e){return x(5,e)})),g),O=function(e){var t=e.team===p.Neutral||function(e,t){if(e.team===t)return!0;var o=!0,n=!1,a=void 0;try{for(var r,d=e.adj[Symbol.iterator]();!(o=(r=d.next()).done);o=!0){if(r.value.team===t)return!0}}catch(c){n=!0,a=c}finally{try{o||null==d.return||d.return()}finally{if(n)throw a}}return!1}(e.node,e.team),o=e.team!==p.Neutral&&(void 0!==e.nodeSelected&&t||e.node.team===e.team),n=e.node===e.nodeHovered,a=t?w[e.node.team]:w[p.Neutral],d=t?"#eeeeee":w[p.Neutral],c=o&&n;return r.a.createElement("g",{style:{cursor:o&&n?"pointer":"default"},onMouseEnter:function(){void 0!==e.onMouseEnterNode&&e.onMouseEnterNode(e.node)},onMouseLeave:function(){void 0!==e.onMouseLeaveNode&&e.onMouseLeaveNode(e.node)}},N[t?e.node.type:I.Normal]({cx:e.node.x,cy:e.node.y,fill:c?d:a,stroke:c?a:d}),r.a.createElement("text",{className:b.a.mapNodeText,dominantBaseline:"middle",x:e.node.x,y:e.node.y,style:{fill:c?a:d,stroke:c?d:a}},t?e.node.troops:null))},H=o(16),L=o.n(H),j=function(e){var t=e.team===p.Neutral||e.node1.team===e.team||e.node2.team===e.team;return r.a.createElement("line",{className:t?L.a.mapEdgeVisible:L.a.mapEdgeInvisible,x1:e.node1.x,y1:e.node1.y,x2:e.node2.x,y2:e.node2.y,style:{stroke:t?"#eeeeee":w[p.Neutral],strokeWidth:5/9,transition:"stroke 0.15s"}})},P=(o(73),function(e){var t=void 0!==e.nodeHoveredID?e.map.nodes[e.nodeHoveredID]:void 0,o=void 0!==e.nodeSelectedID?e.map.nodes[e.nodeSelectedID]:void 0,n=e.map.nodes.map((function(n){return r.a.createElement(O,{node:n,team:e.team,nodeHovered:t,nodeSelected:o,onMouseEnterNode:e.onMouseEnterNode,onMouseLeaveNode:e.onMouseLeaveNode,key:"node_".concat(n.id)})})),a=e.map.edges.map((function(t){var n=Object(i.a)(t,2),a=n[0],d=n[1];return r.a.createElement(j,{node1:a,node2:d,team:e.team,nodeSelected:o,key:"edge_".concat(a.id,"_").concat(d.id)})}));return r.a.createElement(r.a.Fragment,null,a.concat(n))}),_=o(17),C=o.n(_),R=function(e){var t=w[e.army.team];return Object(a.useEffect)((function(){var t=e.army.from,o=e.army.to,n=o.x-t.x,a=o.y-t.y,r=Math.sqrt(n*n+a*a),d=3+e.army.distance*(r-4-2)/r,c=Math.atan2(a,n),i=t.x+Math.cos(c)*d,m=t.y+Math.sin(c)*d;e.army.distance>0?h.a.to(".army-".concat(e.army.id),.5,{x:i,y:m,ease:"none"}):h.a.set(".army-".concat(e.army.id),{x:i,y:m})}),[e.army]),e.team!==p.Neutral&&e.army.from.team!==e.team&&e.army.to.team!==e.team?r.a.createElement(r.a.Fragment,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("circle",{className:"".concat(C.a.mapArmyCircle," army-").concat(e.army.id),r:1,style:{fill:t}}),r.a.createElement("text",{className:"".concat(C.a.mapArmyText," army-").concat(e.army.id),dominantBaseline:"middle",style:{stroke:t}},e.army.troops))},A=o(35),F=o.n(A),W=function(e){return Object(a.useEffect)((function(){var t=".selected-node-".concat(e.node.id),o=void 0,n=h.a.fromTo(t,.15,{transformOrigin:"center center",opacity:0,scale:.5},{transformOrigin:"center center",opacity:1,scale:1,ease:"power1.out",onComplete:function(){o=h.a.timeline({repeat:-1});for(var e=0;e<8;e++)o.to(t,5/8,{scale:1.1,ease:"power1.inOut"},">"),o.to(t,5/8,{scale:1,ease:"power1.inOut"},">");o.fromTo(t,10,{rotate:"0deg",ease:"none"},{rotate:"360deg",ease:"none"},0)}});return function(){void 0!==o&&o.kill(),n.kill()}}),[e.node.id]),r.a.createElement("circle",{className:"".concat(F.a.selectedCircle," selected-node-").concat(e.node.id),cx:e.node.x,cy:e.node.y,r:2.8,strokeDasharray:2.8*Math.PI/10,style:void 0!==e.color?{stroke:e.color}:{}})},Y=function(e){var t=function(e){if(0===e.map.nodes.length)return[-10,10,-10,10];var t=e.map.nodes[0].x,o=t,n=e.map.nodes[0].y,a=n,r=!0,d=!1,c=void 0;try{for(var i,m=e.map.nodes[Symbol.iterator]();!(r=(i=m.next()).done);r=!0){var s=i.value;t=Math.min(t,s.x),o=Math.max(o,s.x),n=Math.min(n,s.y),a=Math.max(a,s.y)}}catch(l){d=!0,c=l}finally{try{r||null==m.return||m.return()}finally{if(d)throw c}}return[t-10,o+10,n-10,a+10]}(e.game),o=Object(i.a)(t,4),n=o[0],d=o[1],c=o[2],m=o[3],s=Math.max(d-n,m-c),l=Math.min(20,s);Object(a.useEffect)((function(){var e,t={x:0,y:0},o=function(t){e=t,h.a.to("#game-svg",.3,{attr:{viewBox:"".concat(e.x-e.d/2," ").concat(e.y-e.d/2," ").concat(e.d," ").concat(e.d)},ease:"power3.out"})};o({x:(n+d)/2,y:(c+m)/2,d:(s+l)/2});var a=function(a){t={x:a.clientX,y:a.clientY},1===(1&(a.buttons||a.which))&&o({x:Math.min(Math.max(e.x-a.movementX*e.d/Math.min(window.innerWidth,window.innerHeight),n+e.d/2),d-e.d/2),y:Math.min(Math.max(e.y-a.movementY*e.d/Math.min(window.innerWidth,window.innerHeight),c+e.d/2),m-e.d/2),d:e.d})},r=function(a){if(!(e.d<=l&&a.deltaY<0||e.d>=s&&a.deltaY>0)){var r=Math.min(Math.max(e.d*Math.pow(1.2,a.deltaY>0?1:-1),l),s);o({x:Math.min(Math.max(e.x+(t.x-window.innerWidth/2)/Math.min(window.innerWidth,window.innerHeight)*(e.d-r),n+r/2),d-r/2),y:Math.min(Math.max(e.y+(t.y-window.innerHeight/2)/Math.min(window.innerWidth,window.innerHeight)*(e.d-r),c+r/2),m-r/2),d:r})}};return document.addEventListener("mousemove",a),document.addEventListener("wheel",r),function(){document.removeEventListener("mousemove",a),document.removeEventListener("wheel",r)}}),[n,d,c,m,s,l]);var u=e.game.armies.sort((function(e,t){return e.troops-t.troops})).map((function(t){return r.a.createElement(R,{army:t,team:e.team,key:"army_".concat(t.id)})})),v=void 0!==e.nodeSelectedID?e.game.map.nodes[e.nodeSelectedID]:void 0;return r.a.createElement("div",{className:"game"},r.a.createElement("svg",{id:"game-svg",width:"100%",height:"100%"},r.a.createElement(P,{map:e.game.map,team:e.team,nodeHoveredID:e.nodeHoveredID,nodeSelectedID:e.nodeSelectedID,onMouseEnterNode:e.onMouseEnterNode,onMouseLeaveNode:e.onMouseLeaveNode}),u,void 0!==v?r.a.createElement(W,{node:v,key:v.id}):null,void 0!==v&&void 0!==v.assign?r.a.createElement(W,{node:v.assign,color:"#eeee00",key:v.assign.id}):null))},T=function(e){var t=Object(a.useReducer)(S,D),o=Object(i.a)(t,2),n=o[0],d=o[1],c=Object(a.useCallback)((function(e){d({type:l.SetNodeHoveredID,nodeHoveredID:e.id})}),[d]),m=Object(a.useCallback)((function(){d({type:l.SetNodeHoveredID,nodeHoveredID:void 0})}),[d]),s=Object(a.useCallback)((function(t){if(void 0!==e.socket&&void 0!==e.room&&void 0!==e.room.game&&void 0!==e.player&&void 0!==n.nodeSelectedID){var o=e.room.game.map.nodes[n.nodeSelectedID];if(void 0!==o&&o.team===e.player.team){var a=t.which||t.keyCode,r=!0;switch(String.fromCharCode(a)){case"A":e.socket.emit("build",n.nodeSelectedID,I.Factory);break;case"S":e.socket.emit("build",n.nodeSelectedID,I.PowerPlant);break;case"Z":e.socket.emit("build",n.nodeSelectedID,I.Fort);break;case"X":e.socket.emit("build",n.nodeSelectedID,I.Artillery);break;case"Q":if(void 0===n.nodeHoveredID||n.nodeHoveredID===n.nodeSelectedID)break;e.socket.emit("sendArmy",n.nodeSelectedID,n.nodeHoveredID,10),r=!1;break;case"W":if(void 0===n.nodeHoveredID||n.nodeHoveredID===n.nodeSelectedID)break;e.socket.emit("sendArmy",n.nodeSelectedID,n.nodeHoveredID,100),r=!1;break;case"E":if(n.nodeHoveredID===n.nodeSelectedID)break;e.socket.emit("assign",n.nodeSelectedID,void 0!==n.nodeHoveredID?n.nodeHoveredID:-1),r=!1}r&&d({type:l.SetNodeSelectedID,nodeSelectedID:void 0})}}}),[e,n,d]),u=Object(a.useCallback)((function(){if(d({type:l.SetMouseDown,mouseDown:!0}),void 0!==n.nodeHoveredID&&void 0!==e.room&&void 0!==e.room.game&&e.player.team!==p.Neutral){var t=e.room.game.map.nodes[n.nodeHoveredID];if(void 0!==t&&t.team===e.player.team)return void d({type:l.SetNodeSelectedID,nodeSelectedID:t.id})}d({type:l.SetNodeSelectedID,nodeSelectedID:void 0})}),[e,n,d]),v=Object(a.useCallback)((function(){d({type:l.SetMouseDown,mouseDown:!1})}),[d]);return Object(a.useEffect)((function(){return document.addEventListener("keydown",s),document.addEventListener("mousedown",u),document.addEventListener("mouseup",v),function(){document.removeEventListener("keydown",s),document.removeEventListener("mousedown",u),document.removeEventListener("mouseup",v)}}),[s,u,v]),void 0!==e.room.game?r.a.createElement(Y,{game:e.room.game,team:e.player.team,nodeHoveredID:n.nodeHoveredID,nodeSelectedID:n.nodeSelectedID,onMouseEnterNode:c,onMouseLeaveNode:m}):(e.room.players.length===e.room.summary.maxPlayers&&e.player.id===e.room.players[0].id&&e.socket.emit("startRoom"),r.a.createElement("p",null,"Waiting for at least ",e.room.summary.maxPlayers," players... (currently at ",e.room.summary.nPlayers,"!) ",r.a.createElement("br",null),"Perhaps invite friends or open up a new tab of this game?"))},B=function(){var e=Object(a.useReducer)(v,u),t=Object(i.a)(e,2),o=t[0],d=t[1];return Object(a.useEffect)((function(){console.log("connecting!");var e=s.a.connect("https://riskystrats.herokuapp.com");return d({type:n.SetSocket,socket:e}),e.on("roomList",(function(e){var t=JSON.parse(e);d({type:n.SetRoomList,roomList:t})})),e.on("playerData",(function(e){var t=JSON.parse(e);d({type:n.SetPlayer,player:t})})),e.on("roomData",(function(e){var t=JSON.parse(e),o=null!==t?function(e){if(void 0===e.game)return{game:void 0,players:e.players,spectators:e.spectators,summary:e.summary};var t=e.game.map,o=t.nodes.map((function(e){return{x:e.x,y:e.y,id:e.id,adj:[],team:e.team,troops:e.troops,type:e.type,assign:void 0}})),n=!0,a=!1,r=void 0;try{for(var d,c=t.nodes[Symbol.iterator]();!(n=(d=c.next()).done);n=!0){var m=d.value,s=o[m.id],l=!0,u=!1,v=void 0;try{for(var y,p=m.adj[Symbol.iterator]();!(l=(y=p.next()).done);l=!0){var f=y.value;s.adj.push(o[f])}}catch(S){u=!0,v=S}finally{try{l||null==p.return||p.return()}finally{if(u)throw v}}s.assign=m.assign>=0?o[m.assign]:void 0}}catch(S){a=!0,r=S}finally{try{n||null==c.return||c.return()}finally{if(a)throw r}}var D=e.game.armies.map((function(e){return{from:o[e.from],to:o[e.to],troops:e.troops,distance:e.distance,team:e.team,id:e.id}}));return{game:{map:{nodes:o,edges:t.edges.map((function(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];return[o[n],o[a]]}))},armies:D},players:e.players,spectators:e.spectators,summary:e.summary}}(t):void 0;d({type:n.SetRoom,room:o})})),function(){e.disconnect(),d({type:n.SetSocket,socket:void 0})}}),[d]),void 0!==o.socket&&void 0!==o.player&&void 0!==o.room?r.a.createElement(T,{socket:o.socket,player:o.player,room:o.room}):r.a.createElement(y,{socket:o.socket,roomList:o.roomList})};o(74);var J=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(B,null))};c.a.render(r.a.createElement(J,null),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.5158ea85.chunk.js.map